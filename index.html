<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bingo Board</title>
  <style>
    :root {
      --board-bg: #1a1a1a; --text-light: #f0f0f0; --text-dark: #222;
      --accent-color: #00b8d4; --modal-bg: rgba(20, 20, 20, 0.95);
      --input-bg: #333; --border-color: #444; --error-bg: #4d2a2a;
      --error-border: #c0392b; --font-main: 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
    }
    body {
      font-family: var(--font-main); background-color: var(--board-bg); color: var(--text-light);
      margin: 0; padding: 1rem; display: flex; flex-direction: column;
      align-items: center; min-height: 100vh; box-sizing: border-box;
    }
    .global-loader {
        position: fixed; top: 0; left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(to right, var(--accent-color) 20%, #00d9f5 50%, var(--accent-color) 80%);
        background-size: 200% auto;
        animation: loading-animation 1.5s linear infinite;
        z-index: 9999;
        display: block;
    }
    @keyframes loading-animation { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .controls { width: 100%; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    h1 { margin: 0; font-size: 1.5rem; font-weight: 500; }
    #team-selector { padding: 0.5rem 1rem; font-size: 1rem; background-color: var(--input-bg); color: var(--text-light); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; }
    #board-container {
      position: relative; width: 100%;
      background-size: cover; background-position: center;
      border-radius: 12px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5); overflow: hidden;
      display: flex; justify-content: center; align-items: center;
      /* IMPROVEMENT: Placeholder background */
      background-color: #222;
      background-image: linear-gradient(45deg, #2a2a2a 25%, transparent 25%), linear-gradient(-45deg, #2a2a2a 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #2a2a2a 75%), linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
      /* The size for the placeholder gradient is now handled in JS to avoid conflicts */
    }
    .tile-overlay:hover {
      /* FIX: Use border-color for hover to be consistent with setup page */
      border-color: var(--accent-color);
      z-index: 2;
    }
    @keyframes pulse-border {
      0% { box-shadow: 0 0 0 0 rgba(229, 115, 115, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(229, 115, 115, 0); }
      100% { box-shadow: 0 0 0 0 rgba(229, 115, 115, 0); }
    }
    .tile-overlay {
      position: absolute; 
      box-sizing: border-box;
      /* FIX: Use CSS variables for the border, matching setup.html */
      border-width: var(--tile-border-width, 2px);
      border-color: var(--tile-border-color, transparent);
      transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
      display: flex; align-items: center; justify-content: center; text-align: center;
      color: white; font-weight: bold; text-shadow: 1px 1px 3px black;
      font-size: 0.9rem; padding: 4px; cursor: pointer;
    }
    .tile-overlay.requires-action {
      animation: pulse-border 2s infinite; /* Enable animation only for these tiles */
    }
    .stamp-image {
      position: absolute; width: 100%; height: 100%; background-size: contain;
      background-repeat: no-repeat; pointer-events: none; background-position: center;
    }
    .info-container {
      display: flex; flex-direction: column; gap: 1.5rem; margin-top: 1.5rem; width: 100%;
    }
    #color-key-container {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;
      padding: 1rem; background-color: var(--input-bg); border-radius: 8px;
    }
    .key-item {
      display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
      font-size: 0.8rem; color: var(--secondary-text, #a0a0a0);
    }
    /* NEW: Ensure all tile previews in the legend are vertically aligned */
    .key-item .tile-overlay {
      vertical-align: middle;
      outline: 1px solid transparent; /* Add a transparent outline to prevent layout shift on hover */
    }
    /* NEW: Styles for the table-based scoreboard, matching overview.html */
    .scoreboard-wrapper {
      display: none; /* Controlled by JS */
      padding: 1.5rem;
      background-color: var(--input-bg);
      border-radius: 8px;
    }
    .scoreboard-wrapper h2 { margin: 0 0 1rem 0; text-align: center; font-weight: 500; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
    #scoreboard-table { width: 100%; border-collapse: collapse; }
    #scoreboard-table th, #scoreboard-table td {
      padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color);
    }
    #scoreboard-table th { font-weight: bold; }
    #scoreboard-table tr:last-child td { border-bottom: none; }
    #scoreboard-table td:nth-child(1) { font-weight: bold; width: 40px; } /* Rank */
    #scoreboard-table td:nth-child(3), #scoreboard-table td:nth-child(4) { text-align: right; } /* Tiles, Score */


    #submission-modal, #welcome-modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; /* Login modal shares some styles */
      background-color: var(--modal-bg); backdrop-filter: blur(5px); justify-content: center; align-items: center;
      padding: 1rem; box-sizing: border-box;
    }
    .modal-content {
      background-color: #2a2a2a; padding: 2rem; border-radius: 12px; width: 100%;
      max-width: 500px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative;
      max-height: 95vh; overflow-y: auto;
    }
    .close-button {
      position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem;
      font-weight: bold; color: #aaa; cursor: pointer; line-height: 1;
    }
    .close-button:hover { color: white; }
    #submission-form h2 { margin-top: 0; }
    #submission-form h3 { margin: 0.5rem 0 1rem 0; color: var(--accent-color); }
    #submission-form p { color: #ccc; }
    #submission-form label { display: block; margin-top: 1rem; }
    #submission-form input, #submission-form textarea {
      width: 100%; padding: 0.75rem; margin-top: 0.5rem; background-color: var(--input-bg);
      border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-light); box-sizing: border-box;
    }
    #submission-form .checkbox-container { display: flex; align-items: center; margin-top: 1.5rem; gap: 0.5rem; }
    #submission-form input[type="checkbox"] { width: auto; margin: 0; }
    #submission-form button {
      width: 100%; padding: 0.75rem; margin-top: 1.5rem; background-color: var(--accent-color);
      color: var(--text-dark); font-weight: bold; font-size: 1rem; border: none;
      border-radius: 8px; cursor: pointer; transition: background-color 0.2s;
    }
    #submission-form button:hover { background-color: #00d9f5; }
    /* NEW: Resubmit button style */
    #submission-form button.resubmit-btn {
        background-color: var(--error-border);
        color: var(--text-light);
    }
    #submission-form button.resubmit-btn:hover {
        background-color: #e74c3c;
    }
    /* NEW: Secondary button style */
    #submission-form button.secondary-btn {
        background-color: #555;
        color: var(--text-light);
    }
    #submission-form button.secondary-btn:hover {
        background-color: #666;
    }
    /* NEW: Adjust width for side-by-side buttons */
    #modal-action-buttons button { width: auto; flex-grow: 1; }
    #submission-form button:disabled { background-color: #555; cursor: not-allowed; }
    /* --- NEW: Evidence Input Styling --- */
    #player-name-container {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    #team-members-checkboxes {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem 1rem; /* row-gap column-gap */
        max-height: 150px;
        overflow-y: auto;
    }
    .player-checkbox-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        white-space: nowrap;
    }
    .player-name-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    #manual-player-name {
        margin-top: 0.25rem;
    }
    #evidence-container { display: flex; flex-direction: column; gap: 1rem; margin-top: 0.5rem; }
    .evidence-item {
        background-color: var(--input-bg); padding: 1rem; border-radius: 8px;
        border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 0.75rem;
    }
    .evidence-item-header { display: flex; justify-content: space-between; align-items: center; }
    .evidence-item-header label { margin: 0; font-weight: bold; }
    .remove-evidence-btn {
        background: none; border: none; color: #aaa; font-size: 1.2rem;
        cursor: pointer; padding: 0 0.5rem; line-height: 1;
    }
    .remove-evidence-btn:hover { color: var(--error-border); }
    #add-evidence-btn {
        width: auto; padding: 0.5rem 1rem; margin-top: 1rem; background-color: transparent;
        color: var(--accent-color); border: 1px dashed var(--accent-color);
        font-weight: normal; font-size: 0.9rem;
    }
    #add-evidence-btn:hover { background-color: rgba(0, 184, 212, 0.1); }
    /* NEW: Admin Feedback Display */
    #admin-feedback-display {
        display: none; /* Hidden by default */
        background-color: var(--error-bg);
        border: 1px solid var(--error-border);
        border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;
    }
    #admin-feedback-display h4 { margin: 0 0 0.5rem 0; color: #ffc107; }
    .error-message {
        padding: 2rem; background-color: var(--error-bg); border: 2px dashed var(--error-border);
        border-radius: 8px; text-align: center; width: 80%; word-wrap: break-word; position: absolute; z-index: 1;
    }
    #message-box {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background-color: #333; color: white; padding: 1rem 2rem; border-radius: 8px;
      z-index: 2000; opacity: 0; transition: opacity 0.5s; pointer-events: none;
    }
    #message-box.show { opacity: 1; }
    /* --- NEW: Tooltip Style --- */
    #tile-tooltip {
      display: none;
      position: fixed;
      z-index: 1001;
      background-color: #111;
      color: #fff;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      max-width: 300px;
      pointer-events: none;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    #tile-tooltip h4 {
        margin: 0 0 0.5rem 0;
        color: var(--accent-color);
        font-size: 1rem;
    }
    #tile-tooltip p {
        margin: 0;
        color: #ccc;
    }
    /* --- NEW: Welcome Modal Styles --- */
    #welcome-modal .modal-content p {
        white-space: pre-wrap;
        text-align: left;
        margin: 1rem 0 1.5rem 0;
        color: #ccc;
    }
    #welcome-modal .modal-content h2 {
        margin-top: 0;
        color: var(--accent-color);
    }
    #welcome-form label {
        display: block;
        margin-bottom: 0.5rem;
    }
    #welcome-form input {
        width: 100%; padding: 0.75rem; background-color: var(--input-bg);
        border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-light); box-sizing: border-box;
    }
    #welcome-form button {
        width: 100%; padding: 0.75rem; margin-top: 1.5rem; background-color: var(--accent-color);
        color: var(--text-dark); font-weight: bold; font-size: 1rem; border: none;
        border-radius: 8px; cursor: pointer; transition: background-color 0.2s;
    }
    #welcome-form button:hover {
        background-color: #00d9f5;
    }
    /* --- NEW: Login Modal Styles --- */
    #login-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: var(--modal-bg); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
    #login-modal .modal-content { max-width: 400px; text-align: center; }
    #login-modal h2 { margin-top: 0; color: var(--accent-color); }
    .login-options { display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem; }
    .login-options button {
        width: 100%; padding: 0.75rem; font-size: 1rem; border-radius: 8px;
        cursor: pointer; transition: background-color 0.2s; display: flex;
        align-items: center; justify-content: center; gap: 0.75rem;
    }
    #login-google { background-color: #4285F4; color: white; border: none; }
    #login-google:hover { background-color: #5a95f5; }
    #login-anon { background-color: #607d8b; color: white; border: none; }
    #login-anon:hover { background-color: #78909c; }
    .login-options svg { width: 20px; height: 20px; }
    .anon-warning {
        margin-top: 1.5rem; padding: 0.75rem; background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; font-size: 0.85rem;
        text-align: left; color: #ffecb3;
    }
    .anon-warning strong { color: #ffc107; }
    .anon-warning ul { padding-left: 1.25rem; margin: 0.5rem 0 0 0; }
  </style>
</head>
<body>
  <div id="global-loader" class="global-loader"></div>

  <app-navbar></app-navbar>

  <div class="controls">
    <h1 id="page-title">Bingo</h1>
    <select id="team-selector"></select>
  </div>

  <div id="board-container">
    <!-- Tiles will be rendered here -->
  </div>
  <div class="info-container">
    <div id="color-key-container"></div>
    <div id="scoreboard-wrapper" class="scoreboard-wrapper">
      <h2>Scoreboard</h2>
      <table id="scoreboard-table">
        <thead>
          <tr><th>#</th><th>Team</th><th>Tiles</th><th>Score</th></tr>
        </thead>
        <tbody id="scoreboard-container">
        </tbody>
      </table>
    </div>
  </div>
  <div id="submission-modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <form id="submission-form">
        <!-- UPDATED: Tile ID and Name format -->
        <h2 id="modal-tile-name"></h2>
        <h3 id="modal-team-name"></h3>
        <p id="modal-tile-desc"></p>
        <div id="admin-feedback-display">
            <h4>Admin Feedback</h4>
            <p id="admin-feedback-text"></p>
        </div>
        <input type="hidden" id="modal-tile-id">
        <label for="player-name-container">Player Name(s):</label>
        <div id="player-name-container">
            <div id="team-members-checkboxes"></div>
            <div class="player-name-option">
                <input type="checkbox" id="team-submission-checkbox">
                <label for="team-submission-checkbox">Submit for the whole team</label>
            </div>
            <input type="text" id="manual-player-name" placeholder="Manually add other players (comma-separated)">
        </div>
        <input type="hidden" id="player-ids-value" name="player-ids-value">
        <input type="hidden" id="additional-players-value" name="additional-players-value">
        <label id="evidence-label">Evidence:</label>
        <div id="evidence-container"></div>
        <button type="button" id="add-evidence-btn">+ Add Evidence Item</button>
        <label for="notes">Notes and Comments:</label>
        <textarea id="notes" rows="3"></textarea>
        <!-- NEW: Button container for dynamic actions -->
        <div id="modal-action-buttons" style="display: flex; flex-direction: row-reverse; gap: 0.75rem; margin-top: 1.5rem;">
            <!-- Acknowledge button will be dynamically shown/hidden -->
            <button type="button" id="acknowledge-feedback-btn" class="resubmit-btn" style="display: none;">Acknowledge Feedback</button>
            <!-- Main action buttons will be populated by JS -->
            <button type="submit" id="submit-button-main">Submit for Review</button>
            <button type="submit" id="submit-button-secondary" class="secondary-btn">Save as Draft</button>
        </div>
      </form>
    </div>
  </div>
  <div id="message-box"></div>
  <!-- NEW: Tooltip element -->
  <div id="tile-tooltip"></div>

  <script type="module" src="./js/pages/indexController.js"></script>
</body>
</html>