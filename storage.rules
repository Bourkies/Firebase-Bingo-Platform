rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Matches any file in the 'config' directory, which is used for board assets.
    match /config/{allPaths=**} {
      // Allow anyone to read config images (e.g., board background, stamps).
      // This is necessary for players and the public to see the board correctly.
      allow read: if true;

      // Only allow authenticated users who are admins to write or delete files.
      // This rule performs a check against the 'users' collection in Firestore
      // to verify the 'isAdmin' flag for the person making the request.
      allow write, delete: if request.auth != null &&
                             exists(/databases/$(database)/documents/users/$(request.auth.token.email)) &&
                             get(/databases/$(database)/documents/users/$(request.auth.token.email)).data.get('isAdmin', false) == true;
    }

    // By default, deny access to all other paths. You can add more specific
    // rules for other parts of your storage bucket if needed.
  }
}